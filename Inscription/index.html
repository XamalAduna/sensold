<!DOCTYPE html> 
<html lang="fr"> 
<head>
  <meta charset="UTF-8">
  <title>Inscription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {font-family: Arial, sans-serif;background: #f3f3f3;display: flex;justify-content: center;align-items: center;min-height: 100vh;margin: 0;padding: 0;}
    .form-container { position: relative;background: #fff;padding: 25px;border-radius: 10px;box-shadow: 0 5px 15px rgba(0,0,0,0.2);width: 90%;max-width: 400px; position: relative;box-sizing: border-box; margin: 10px;}
    h2 { text-align: center; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input[type="text"], input[type="email"], input[type="password"] {width: 100%;padding: 10px; border-radius: 5px;border: 1px solid #ccc;box-sizing: border-box;font-size: 16px; }
    input:focus { border-color: #009688; outline: none; }
    .error { color: red; font-size: 13px; margin-top: 3px; }
    .success { color: green; font-size: 14px; margin-top: 10px; text-align: center; }
    .password-wrapper { position: relative; }
    .toggle-password { position: absolute;right: 10px;top: 50%;transform: translateY(-50%);cursor: pointer;font-size: 18px;color: #666;}
    button { width: 100%;padding: 12px;background: #009688;border: none;color: white;font-size: 16px;border-radius: 5px;cursor: pointer;}
    button:hover { background: #00796B; }
    .checkbox-group { margin-bottom: 15px; }
    .loader {display: none;border: 4px solid #f3f3f3; border-top: 4px solid #009688;border-radius: 50%;width: 30px; height: 30px; animation: spin 1s linear infinite;margin: 15px auto;}
    @keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}
    @media (max-width: 600px) {
    .form-container { padding: 20px; width: 95%; }
     h2, input, button, a {font-size: 16px; }}
    .brand-text {position: absolute;top: 10px;left: 15px;font-weight: bold;font-size: 18px;color: #009688;}
  </style>
</head>
<body>
  <div class="form-container">
    <div class="brand-text">SenSold</div>
    <h2>Inscription</h2>
    <form id="registerForm" novalidate>
      <div class="form-group">
        <label>Nom et Pr√©nom</label>
        <input type="text" id="fullName" required>
        <div class="error" id="fullNameError"></div>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" required>
        <div class="error" id="emailError"></div>
      </div>
      <div class="form-group password-wrapper">
        <label>Mot de passe</label>
        <input type="password" id="password" required>
        <span class="toggle-password" onclick="togglePassword('password', this)">üëÅÔ∏è</span>
        <div class="error" id="passwordError"></div>
      </div>
      <div class="form-group password-wrapper">
        <label>Confirmer le mot de passe</label>
        <input type="password" id="confirmPassword" required>
        <span class="toggle-password" onclick="togglePassword('confirmPassword', this)">üëÅÔ∏è</span>
        <div class="error" id="confirmPasswordError"></div>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="acceptTerms" required>
        <label for="acceptTerms">
          J'accepte les <a style="color: #009688;text-decoration: none;" href="../Conditions/" target="_blank">conditions g√©n√©rales d‚Äôutilisation et les r√®gles de diffusion.</a>
        </label>
        <div class="error" id="acceptTermsError"></div>
      </div>
      <div class="form-group">
        <div id="recaptcha"></div>
        <div class="error" id="recaptchaError"></div>
      </div>
      <button type="submit">S'inscrire</button>
      <div class="loader" id="loader"></div>
      <div id="globalMessage"></div>
    </form>
  </div>
  <script>
    function togglePassword(fieldId, el) {
      const field = document.getElementById(fieldId);
      field.type = field.type === "password" ? "text" : "password";
      el.textContent = field.type === "password" ? "üëÅÔ∏è" : "üôà";}
  </script>
  <script src="https://www.google.com/recaptcha/api.js?onload=initRecaptcha&render=explicit&hl=fr" async defer></script>
  <script>
    let recaptchaWidgetId;
    function initRecaptcha() {
      recaptchaWidgetId = grecaptcha.render('recaptcha', {
        'sitekey': '6Lcej7srAAAAAP447wZkg9mQeoLzU36ElSI7RTsf'});}
  </script>
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDLrPKEzDueP4j-HjAdOhmkuA74cLsCn2M",
  authDomain: "diallo-ee5aa.firebaseapp.com",
  projectId: "diallo-ee5aa",
  storageBucket: "diallo-ee5aa.firebasestorage.app",
  messagingSenderId: "662485613383",
  appId: "1:662485613383:web:c1129a35c335cc95c0ea62",
  measurementId: "G-F3092DTNZY"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const registerForm = document.getElementById("registerForm");
const globalMessage = document.getElementById("globalMessage");
const loader = document.getElementById("loader");
registerForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  document.querySelectorAll(".error").forEach(el => el.textContent = "");
  globalMessage.textContent = "";
  globalMessage.className = "";
  const fullName = document.getElementById("fullName").value.trim();
  const emailValue = document.getElementById("email").value.trim();
  const passwordValue = document.getElementById("password").value;
  const confirmPasswordValue = document.getElementById("confirmPassword").value;
  const acceptTerms = document.getElementById("acceptTerms").checked;
  const recaptchaResponse = grecaptcha.getResponse(recaptchaWidgetId);
  let valid = true;
  if (!fullName) { document.getElementById("fullNameError").textContent = "Veuillez entrer votre nom et pr√©nom."; valid = false; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(emailValue)) { document.getElementById("emailError").textContent = "Veuillez entrer un email valide."; valid = false; }
  if (!/^(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(passwordValue)) { document.getElementById("passwordError").textContent = "Le mot de passe doit contenir au moins 8 caract√®res, une majuscule et une minuscule."; valid = false; }
  if (passwordValue !== confirmPasswordValue) { document.getElementById("confirmPasswordError").textContent = "Les mots de passe ne correspondent pas."; valid = false; }
  if (!acceptTerms) { document.getElementById("acceptTermsError").textContent = "Vous devez accepter les conditions de confidentialit√©."; valid = false; }
  if (!recaptchaResponse) { document.getElementById("recaptchaError").textContent = "Veuillez valider le reCAPTCHA."; valid = false; }
  if (!valid) return;
  try {
    loader.style.display = "block";
    const userCredential = await createUserWithEmailAndPassword(auth, emailValue, passwordValue);
    const user = userCredential.user;
    await sendEmailVerification(user, {
      url: "https://xamaladuna.github.io/Autoparts/baba.html"
    });
    await setDoc(doc(db, "users", user.uid), {
      fullName, email: emailValue, createdAt: new Date(),subscribe: false, 
     subscribeEnd: "", emailVerified: false
    });
    await signOut(auth);
    globalMessage.textContent = "‚úÖ Inscription r√©ussie ! V√©rifiez votre bo√Æte mail pour confirmer votre compte avant de vous connecter.";
    globalMessage.className = "success";
    registerForm.reset();
    grecaptcha.reset(recaptchaWidgetId);
  } catch (error) {
    let message = "Une erreur est survenue.";
    if (error.code === "auth/email-already-in-use") message = "Cet email est d√©j√† utilis√©.";
    else if (error.code === "auth/invalid-email") message = "Format d'email invalide.";
    else if (error.code === "auth/weak-password") message = "Mot de passe trop faible (‚â•8 caract√®res, majuscule/minuscule).";
    globalMessage.textContent = message;
    globalMessage.className = "error";
  } finally {
    loader.style.display = "none";
  }
});
</script>
</body>
</html>
